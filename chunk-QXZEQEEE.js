import{a as Se}from"./chunk-DYZ2UK7G.js";import{a as ge,b as he,c as fe,d as Ne}from"./chunk-AEPMFU2B.js";import{c as _,d as y,n as Q,o as X,p as Me,s as Re,t as ee,u as ke}from"./chunk-HD4ISDNJ.js";import"./chunk-3LEWPSQC.js";import{a as te,b as Pe,c as Te}from"./chunk-WTEB7XGH.js";import{a as J}from"./chunk-DXVTN2QW.js";import{c as U,d as m,e as j,f as O,g as B,h as S,j as z,l as W,n as Y,u as ye,v as K,w as Le}from"./chunk-IL5YMPHM.js";import{N as V,O as q,S as de,X as Z,aa as be,c as Ee,m as _e,ma as H,na as Fe}from"./chunk-I5PCDVRR.js";import{C as pe,D as k,Db as r,E as ue,Eb as i,Fb as h,Ia as I,Ja as $,Jb as G,L as ce,Mb as D,Nb as f,Wb as a,a as M,b as R,bc as v,cc as C,db as s,dc as x,e as Ve,jc as E,oa as N,qb as c,sb as d,ta as p,w as me,ya as P,yb as u,za as T}from"./chunk-7JXHIXKM.js";var ve={};Ve(ve,{signIn$:()=>Ue,signUp$:()=>qe});var A=_("[Auth] Sign Up",y()),w=_("[Auth] Sign In",y()),b=_("[Auth] Auth Success",y()),F=_("[Auth] Auth Failure",y());var qe=ge(()=>{let e=p(he),n=p(Se);return e.pipe(fe(A),ue(o=>n.signup(o.payload).pipe(pe(t=>b({response:t})),ce(t=>me(F({error:t}))))))},{functional:!0}),Ue=ge(()=>{let e=p(he),n=p(Se);return e.pipe(fe(w),ue(o=>n.signin(o.payload).pipe(pe(t=>(window.localStorage.setItem("token",t.token??""),window.localStorage.setItem("login",o.payload.email??""),window.localStorage.setItem("isAuthenticated",t.token.length>0?"1":"0"),n.isLoggedIn.next(!0),b({response:t}))),ce(t=>me(F({error:t}))))))},{functional:!0});var je={response:null,error:null,isLoading:!1},Ie=ke(je,ee(A,w,e=>R(M({},e),{isLoading:!0,error:null})),ee(b,(e,{response:n})=>R(M({},e),{isLoading:!1,response:n,error:null})),ee(F,(e,{error:n})=>R(M({},e),{isLoading:!1,response:null,error:n})));var Ae=()=>{let e=!0;return window.localStorage.getItem("isAuthenticated")==="1"&&(e=!1),e};var we=Me("auth"),oe=X(we,e=>e.response),re=X(we,e=>e.error),$e=X(we,e=>e.isLoading);function Je(e,n){e&1&&(r(0,"small",9),a(1,"Email is required"),i())}function Ke(e,n){e&1&&(r(0,"small",9),a(1,"Email is invalid"),i())}function Qe(e,n){if(e&1&&c(0,Je,2,0,"small",9)(1,Ke,2,0,"small",9),e&2){let o=f(),t=x(8);u(t.hasError("required")&&o.isShowingErrors?0:-1),s(),u(t.hasError("email")&&o.isShowingErrors?1:-1)}}function Xe(e,n){e&1&&(r(0,"small",9),a(1,"Password is required"),i())}var ne=class e{store=p(Q);router=p(V);messageService=p(Z);isShowingErrors=!1;loginForm=new B({email:new S("",[m.required,m.email]),password:new S("",[m.required,m.minLength(8),m.maxLength(30)])});authResponse$;authError$;authLoading$;constructor(){this.authResponse$=this.store.select(oe),this.authError$=this.store.select(re),this.authLoading$=this.store.select($e)}onLogin(){if(this.isShowingErrors=!0,this.loginForm.invalid)return;let{email:n,password:o}=this.loginForm.value;this.store.dispatch(w({payload:{email:n,password:o}})),k([this.authError$,this.authResponse$]).subscribe(([t,l])=>{t?.error.message?(this.messageService.clear(),this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})):l&&(this.router.navigate(["/"]),this.messageService.clear(),this.messageService.add({severity:"success",summary:"Success",detail:"Login successful. Welcome!"}))})}static \u0275fac=function(o){return new(o||e)};static \u0275cmp=P({type:e,selectors:[["app-signin"]],decls:33,vars:6,consts:[["id","stripe-login",3,"ngSubmit","formGroup"],[1,"field","padding-bottom--24"],["for","email"],["id","email","pInputText","","formControlName","email","type","email","placeholder","hello@world.com",1,"input"],[1,"grid--50-50"],["for","password"],[1,"reset-pass"],["href","#"],["id","password","formControlName","password","styleClass","test",3,"toggleMask","feedback"],[1,"p-error"],[1,"field","field-checkbox","padding-bottom--24","flex-flex","align-center"],["for","checkbox"],["type","checkbox","name","checkbox"],["type","submit","label","Sign In"],[1,"field"],["href","#",1,"ssolink"],[1,"footer-link","padding-top--24"],["routerLink","/auth/signup"]],template:function(o,t){if(o&1){let l=G();r(0,"app-auth-form")(1,"form",0),D("ngSubmit",function(){return I(l),$(t.onLogin())}),r(2,"h1"),a(3,"Sign In"),i(),r(4,"div",1)(5,"label",2),a(6,"Email"),i(),h(7,"input",3),v(8),c(9,Qe,2,2),i(),r(10,"div",1)(11,"div",4)(12,"label",5),a(13,"Password"),i(),r(14,"div",6)(15,"a",7),a(16,"Forgot your password?"),i()()(),h(17,"p-password",8),c(18,Xe,2,0,"small",9),i(),r(19,"div",10)(20,"label",11),h(21,"input",12),a(22," Stay signed in for a week "),i()(),r(23,"div",1),h(24,"p-button",13),i(),r(25,"div",14)(26,"a",15),a(27,"Use single sign-on (Google) instead"),i()()(),r(28,"div",16)(29,"span"),a(30,"Dont have an account? "),r(31,"a",17),a(32,"Sign up"),i()()()()}if(o&2){let l;s(),d("formGroup",t.loginForm),s(7);let g=C(t.loginForm.get("email"));s(),u(g?9:-1),s(8),d("toggleMask",!0)("feedback",!1),s(),u((l=t.loginForm.get("password"))!=null&&l.invalid&&t.isShowingErrors?18:-1)}},dependencies:[K,H,te,q,z,U,j,O,W,Y,J],changeDetection:0})};var ae=(e,n)=>({valid:e,invalid:n});function et(e,n){e&1&&(r(0,"small",7),a(1,"Email is required"),i())}function tt(e,n){e&1&&(r(0,"small",7),a(1,"Email is invalid"),i())}function it(e,n){if(e&1&&c(0,et,2,0,"small",7)(1,tt,2,0,"small",7),e&2){let o=f(),t=x(8);u(t.hasError("required")&&o.isShowingErrors?0:-1),s(),u(t.hasError("email")&&o.isShowingErrors?1:-1)}}function ot(e,n){if(e&1&&(v(0)(1)(2)(3),r(4,"li",16),a(5," At least one lowercase "),i(),r(6,"li",16),a(7," At least one uppercase "),i(),r(8,"li",16),a(9," At least one numeric "),i(),r(10,"li",16),a(11," Number of characters 8-30 "),i()),e&2){f();let o=x(1),t=f(),l=t.isPasswordMatch("[a-z]"),g=t.isPasswordMatch("[A-Z]"),L=t.isPasswordMatch("[0-9]"),xe=o.value.length>=8&&o.value.length<=30;s(4),d("ngClass",E(4,ae,l,!l)),s(2),d("ngClass",E(7,ae,g,!g)),s(2),d("ngClass",E(10,ae,L,!L)),s(2),d("ngClass",E(13,ae,xe,!xe))}}function rt(e,n){if(e&1&&(r(0,"ul",15),v(1),c(2,ot,12,16),i()),e&2){s();let o=C(f().registerForm.get("password"));s(),u(o?2:-1)}}function nt(e,n){e&1&&(r(0,"small",7),a(1,"Password is required"),i())}function at(e,n){e&1&&(r(0,"small",7),a(1,"Passwords do not match"),i())}var se=class e{store=p(Q);router=p(V);messageService=p(Z);isShowingErrors=!1;registerForm=new B({email:new S("",[m.required,m.email]),password:new S("",[m.required,m.minLength(8),m.maxLength(30)]),repeatPassword:new S("",[m.required,m.minLength(8),m.maxLength(30)])},{validators:Te("password","repeatPassword")});authError$;authResponse$;constructor(){this.authError$=this.store.select(re),this.authResponse$=this.store.select(oe)}onRegister(){if(this.isShowingErrors=!0,this.registerForm.invalid)return;let{email:n,password:o}=this.registerForm.value;this.store.dispatch(A({payload:{email:n,password:o}})),k([this.authError$,this.authResponse$]).subscribe(([t,l])=>{t?.error.message?(this.messageService.clear(),this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})):l!==null&&(this.messageService.clear(),this.messageService.add({severity:"success",summary:"Success",detail:"You can now sign in"}),this.router.navigate(["/auth/signin"]))})}isPasswordMatch(n){return new RegExp(n).test(this.registerForm.get("password")?.value||"")}static \u0275fac=function(o){return new(o||e)};static \u0275cmp=P({type:e,selectors:[["app-signup"]],decls:31,vars:8,consts:[["id","stripe-login",3,"ngSubmit","formGroup"],[1,"field","padding-bottom--24"],["for","email"],["id","email","pInputText","","formControlName","email","type","email","placeholder","hello@world.com",1,"input"],["for","password"],["id","password","formControlName","password",3,"toggleMask"],["pTemplate","footer"],[1,"p-error"],["for","repeatPassword"],["id","password","formControlName","repeatPassword",3,"feedback","toggleMask"],["type","submit","label","Sign Up"],[1,"field"],["href","#",1,"ssolink"],[1,"footer-link","padding-top--24"],["routerLink","/auth/signin"],[1,"pl-2","ml-2","mt-0",2,"line-height","1.5"],[3,"ngClass"]],template:function(o,t){if(o&1){let l=G();r(0,"app-auth-form")(1,"form",0),D("ngSubmit",function(){return I(l),$(t.onRegister())}),r(2,"h1"),a(3,"Sign Up"),i(),r(4,"div",1)(5,"label",2),a(6,"Email"),i(),h(7,"input",3),v(8),c(9,it,2,2),i(),r(10,"div",1)(11,"label",4),a(12,"Password"),i(),r(13,"p-password",5),c(14,rt,3,2,"ng-template",6),i(),c(15,nt,2,0,"small",7),i(),r(16,"div",1)(17,"label",8),a(18,"Repeat Password"),i(),h(19,"p-password",9),c(20,at,2,0,"small",7),i(),r(21,"div",1),h(22,"p-button",10),i(),r(23,"div",11)(24,"a",12),a(25,"Use single sign-on (Google) instead"),i()()(),r(26,"div",13)(27,"span"),a(28,"Already have an account? "),r(29,"a",14),a(30,"Sign in"),i()()()()}if(o&2){let l,g;s(),d("formGroup",t.registerForm),s(7);let L=C(t.registerForm.get("email"));s(),u(L?9:-1),s(4),d("toggleMask",!0),s(2),u((l=t.registerForm.get("password"))!=null&&l.invalid&&t.isShowingErrors?15:-1),s(4),d("feedback",!1)("toggleMask",!0),s(),u((g=t.registerForm.get("repeatPassword"))!=null&&g.invalid&&t.isShowingErrors?20:-1)}},dependencies:[K,H,be,te,q,z,U,j,O,W,Y,J,Ee],changeDetection:0})};var st=[{path:"signup",canMatch:[Ae],component:se},{path:"signin",canMatch:[Ae],component:ne}],le=class e{static \u0275fac=function(o){return new(o||e)};static \u0275mod=T({type:e});static \u0275inj=N({imports:[de.forChild(st),de]})};var De=class e{static \u0275fac=function(o){return new(o||e)};static \u0275mod=T({type:e});static \u0275inj=N({imports:[Le,Fe,Pe,le,ye,Re.forFeature("auth",Ie),Ne.forFeature([ve]),_e]})};export{De as AuthModule};
